{% extends 'auth_base.html' %}

{% block titulo %}Definir Nova Senha{% endblock %}

{% block auth_content %}
    <h1 class="font-lora text-3xl text-center text-gray-800 mb-8">Crie sua Nova Senha</h1>

    <form action="" method="post" id="passwordForm">
        {% csrf_token %}
        <div class="mb-4">
            <label for="newPassword" class="sr-only">Nova Senha</label>
            <input type="password" name='new_password1' id="newPassword" placeholder="Digite a nova senha" class="w-full px-4 py-3 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>

        <div class="space-y-2 text-sm text-gray-600 mb-4">
            <div class="flex items-center"><input type="checkbox" id="check-length" class="h-4 w-4" disabled><label for="check-length" class="ml-2">Mínimo 8 caracteres</label></div>
            <div class="flex items-center"><input type="checkbox" id="check-uppercase" class="h-4 w-4" disabled><label for="check-uppercase" class="ml-2">1 Letra maiúscula (A-Z)</label></div>
            <div class="flex items-center"><input type="checkbox" id="check-lowercase" class="h-4 w-4" disabled><label for="check-lowercase" class="ml-2">1 Letra minúscula (a-z)</label></div>
            <div class="flex items-center"><input type="checkbox" id="check-number" class="h-4 w-4" disabled><label for="check-number" class="ml-2">1 Número (0-9)</label></div>
            <div class="flex items-center"><input type="checkbox" id="check-special" class="h-4 w-4" disabled><label for="check-special" class="ml-2">1 Caractere especial (!@#$...)</label></div>
        </div>

        <div class="mb-6">
            <label for="confirmPassword" class="sr-only">Confirmar Senha</label>
            <input type="password" name='new_password2' id="confirmPassword" placeholder="Confirme a senha" class="w-full px-4 py-3 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>
        
        <button type="submit" id="registerButton" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition duration-300">
            Salvar Nova Senha
        </button>
    </form>
    
    <div class="text-center mt-4">
        <a href="{% url 'login' %}" class="text-gray-500 hover:underline text-sm">Voltar ao login</a>
    </div>
{% endblock %}

{% block auth_scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const passwordForm = document.getElementById('passwordForm'); 
    const newPasswordInput = document.getElementById('newPassword');
    const confirmPasswordInput = document.getElementById('confirmPassword');

    const checks = {
        length: document.getElementById('check-length'),
        uppercase: document.getElementById('check-uppercase'),
        lowercase: document.getElementById('check-lowercase'),
        number: document.getElementById('check-number'),
        special: document.getElementById('check-special'),
    };

    passwordForm.addEventListener('submit', (e) => {
        const pass = newPasswordInput.value;
        const confirmPass = confirmPasswordInput.value;

        if (pass !== confirmPass) {
            e.preventDefault();
            showMessage('As senhas não conferem.', true); // showMessage() é do auth_base.html
            return;
        }

        const allChecked = Object.values(checks).every(check => check.checked);
        if (!allChecked) {
            e.preventDefault();
            showMessage('A senha não cumpre todos os requisitos.', true);
        }
    });

    newPasswordInput.addEventListener('input', () => {
        const pass = newPasswordInput.value;
        checks.length.checked = pass.length >= 8;
        checks.uppercase.checked = /[A-Z]/.test(pass);
        checks.lowercase.checked = /[a-z]/.test(pass);
        checks.number.checked = /[0-9]/.test(pass);
        checks.special.checked = /[!@#$%^&*.]/.test(pass);
    });
});
</script>
{% endblock %}